<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SREC Municipal Corporation Complaint System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-container, .status-container {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 0.5rem;
            text-align: center;
        }
        .modal-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100">

<div class="min-h-screen bg-cover bg-center" style="background-image: url('muni1.jpg');">
        <div class="bg-black bg-opacity-50 min-h-screen">
            <header class="bg-white bg-opacity-90 shadow-md">
    <div class="container mx-auto px-6 py-4 flex justify-center items-center gap-4">
        <!-- Logo Image -->
        <img src="logo.png" alt="SREC Logo" class="h-16 w-auto">

        <!-- Text Container -->
        <div>
            <h1 class="text-3xl font-bold text-gray-800">SREC MUNICIPAL CORPORATION</h1>
            <p class="text-gray-600">Complaint Registration & Management System</p>
        </div>
    </div>
</header>

            <main class="container mx-auto px-6 py-12">
                <div class="grid lg:grid-cols-2 gap-12 items-start">
                    <!-- Complaint Registration Form -->
                    <div class="form-container bg-white bg-opacity-80 p-8 rounded-lg shadow-2xl">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Complaint Registration Form</h2>
                        <form id="complaintForm" action="complaint" method="post" enctype="multipart/form-data">
                             <input type="hidden" name="action" value="register">
                            <div class="mb-4">
                                <label for="category" class="block text-gray-700 text-sm font-bold mb-2">Complaint Category:</label>
                                <select id="category" name="category" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                                    <option value="">--Select Category--</option>
                                    <option value="Garbage">Garbage & Sanitation</option>
                                    <option value="Water">Water Supply</option>
                                    <option value="Roads">Roads & Potholes</option>
                                    <option value="Streetlight">Streetlight</option>
                                    <option value="Sewage">Sewage & Drainage</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="location" class="block text-gray-700 text-sm font-bold mb-2">Area / Location:</label>
                                <input type="text" id="location" name="location" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="mb-4">
                                <label for="landmark" class="block text-gray-700 text-sm font-bold mb-2">Landmark:</label>
                                <input type="text" id="landmark" name="landmark" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="mb-4">
                                <label for="description" class="block text-gray-700 text-sm font-bold mb-2">Detailed Description:</label>
                                <textarea id="description" name="description" rows="4" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="image" class="block text-gray-700 text-sm font-bold mb-2">Upload Image (Optional):</label>
                                <input type="file" id="image" name="image" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" accept="image/*">
                            </div>
                            <div class="mb-4">
                                <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Full Name:</label>
                                <input type="text" id="name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="mb-6">
                                <label for="phone" class="block text-gray-700 text-sm font-bold mb-2">Phone Number:</label>
                                <input type="tel" id="phone" name="phone" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required pattern="[0-9]{10}">
                            </div>
                            <div class="flex items-center justify-center">
                                <button type="submit" class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-full focus:outline-none focus:shadow-outline transition duration-300">
                                    Register Complaint
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Check Complaint Status -->
                    <div class="space-y-8">
                        <div class="status-container bg-white bg-opacity-80 p-8 rounded-lg shadow-2xl">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Check Complaint Status</h2>
                            <form id="statusForm">
                                <div class="mb-4">
                                    <label for="complaintId" class="block text-gray-700 text-sm font-bold mb-2">Enter Complaint ID:</label>
                                    <input type="text" id="complaintId" name="complaintId" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                                </div>
                                <div class="flex items-center justify-center">
                                    <button type="submit" class="bg-green-600 hover:bg-green-800 text-white font-bold py-2 px-6 rounded-full focus:outline-none focus:shadow-outline transition duration-300">
                                        Check Status
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div id="statusResult" class="hidden status-container bg-white bg-opacity-80 p-8 rounded-lg shadow-2xl">
                             <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Your Complaint Details</h3>
                             <div id="statusContent" class="text-gray-700 space-y-2"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal for showing messages -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span id="modalClose" class="modal-close">&times;</span>
            <h2 id="modalTitle" class="text-xl font-bold mb-4"></h2>
            <p id="modalMessage"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const complaintForm = document.getElementById('complaintForm');
            const statusForm = document.getElementById('statusForm');
            const statusResult = document.getElementById('statusResult');
            const statusContent = document.getElementById('statusContent');
            
            // Modal elements
            const modal = document.getElementById('messageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalClose = document.getElementById('modalClose');

            // Function to show modal
            function showModal(title, message) {
                modalTitle.textContent = title;
                modalMessage.innerHTML = message;
                modal.style.display = 'block';
            }

            // Close modal events
            modalClose.onclick = () => modal.style.display = 'none';
            window.onclick = (event) => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };
            
            // Handle complaint form submission
            complaintForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                
                showModal('Processing...', 'Please wait while we register your complaint.');

                fetch('complaint', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if(data.success) {
                        showModal('Success!', `Your complaint has been registered successfully. <br>Your Complaint ID is: <strong class="text-xl">${data.complaintId}</strong><br>Please save it for future reference.`);
                        complaintForm.reset();
                    } else {
                        showModal('Error', data.message || 'An unknown error occurred.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showModal('Submission Error', 'Could not connect to the server. Please try again later.');
                });
            });

            // Handle status check form submission
            statusForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const complaintId = document.getElementById('complaintId').value;
                if (!complaintId) {
                    showModal('Invalid Input', 'Please enter a Complaint ID.');
                    return;
                }

                fetch(`complaint?action=status&complaintId=${complaintId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.complaint) {
                        const c = data.complaint;
                        statusContent.innerHTML = `
                            <p><strong>Complaint ID:</strong> ${c.id}</p>
                            <p><strong>Category:</strong> ${c.category}</p>
                            <p><strong>Location:</strong> ${c.location}</p>
                            <p><strong>Date Submitted:</strong> ${new Date(c.submissionDate).toLocaleString()}</p>
                            <p><strong>Status:</strong> <span class="font-bold ${c.status === 'Resolved' ? 'text-green-600' : 'text-yellow-600'}">${c.status}</span></p>
                        `;
                        statusResult.classList.remove('hidden');
                    } else {
                        showModal('Not Found', data.message || 'Could not find a complaint with that ID.');
                        statusResult.classList.add('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showModal('Status Check Error', 'Could not connect to the server. Please try again later.');
                    statusResult.classList.add('hidden');
                });
            });
        });
    </script>
</body>
</html>
